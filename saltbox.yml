---
- hosts: localhost # noqa name[play]
  module_defaults:
    ansible.builtin.setup:
      fact_path: "/srv/git/saltbox/ansible_facts.d"
  vars_files:
    - ['accounts.yml', 'defaults/accounts.yml.default']
    - ['settings.yml', 'defaults/settings.yml.default']
    - ['adv_settings.yml', 'defaults/adv_settings.yml.default']
    - ['backup_config.yml', 'defaults/backup_config.yml.default']
    - ['providers.yml', 'defaults/providers.yml.default']
    - ['hetzner_vlan.yml', 'defaults/hetzner_vlan.yml.default']
  roles:
    - { role: user_check, tags: ['always'] }
    - { role: settings, tags: ['settings'] }
    - { role: pre_tasks, tags: ['always', 'pre-tasks'] }
    - { role: sanity_check, tags: ['always', 'sanity-check'] }
    - { role: backup, tags: ['backup'] }
    - { role: backup2, tags: ['backup2'] }
    - { role: restore, tags: ['restore'] }
    # Core
    - { role: kernel, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'preinstall', 'kernel'] }
    - { role: hetzner, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'preinstall', 'hetzner'] }
    - { role: user, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'preinstall', 'user'] }
    - { role: shell, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'preinstall', 'shell'] }
    - { role: rclone, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'preinstall', 'rclone'] }
    - { role: system, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'system'] }
    - { role: common, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'common'] }
    - { role: motd, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'motd', 'motd-generate-config'], when: ['use_motd'] }
    - { role: mount_templates, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'mounts', 'mount-templates'] }
    - { role: remote, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'mounts'] }
    - { role: unionfs, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'mounts'] }
    - { role: nvidia, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'docker', 'nvidia', 'nvidia-purge'], when: ['use_nvidia'] }
    - { role: docker, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'docker', 'docker-filesystem-resize'] }
    - { role: scripts, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'scripts'] }
    - { role: sandbox, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'sandbox'] }
    - { role: crowdsec, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'crowdsec'], when: ['crowdsec_is_enabled'] }
    - { role: traefik, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'traefik', 'traefik-reset-certs'] }
    - { role: cloudflare, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'cloudflare'], when: ['cloudflare_is_enabled'] }
    - { role: main_tags, tags: ['saltbox', 'mediabox', 'feederbox'] }
    # Apps Start
    - { role: media_server, tags: ['media-server'] }
    - { role: download_clients, tags: ['download-clients'] }
    - { role: download_indexers, tags: ['download-indexers'] }
    - { role: tautulli, tags: ['tautulli'] }
    - { role: overseerr, tags: ['overseerr'] }
    - { role: portainer, tags: ['portainer'] }
    - { role: organizr, tags: ['organizr'] }
    - { role: cloudplow, tags: ['saltbox', 'feederbox', 'cloudplow', 'cloudplow-reset'], when: ['use_cloudplow'] }
    - { role: sonarr, tags: ['sonarr'] }
    - { role: radarr, tags: ['radarr'] }
    - { role: lidarr, tags: ['lidarr'] }
    - { role: iperf3, tags: ['iperf3'] }
    - { role: glances, tags: ['glances'] }
    - { role: btop, tags: ['btop'] }
    - { role: asshama, tags: ['asshama'] }
    - { role: arr_db, tags: ['arr-db'] }
    - { role: authelia, tags: ['authelia', 'authelia-reset', 'lldap-reset'] }
    - { role: authentik, tags: ['authentik', 'authentik-reset'] }
    - { role: autobrr, tags: ['autobrr'] }
    - { role: autoheal, tags: ['autoheal'] }
    - { role: autoscan, tags: ['autoscan'] }
    - { role: bazarr, tags: ['bazarr'] }
    - { role: btrfsmaintenance, tags: ['btrfsmaintenance'] }
    - { role: cadvisor, tags: ['cadvisor'] }
    - { role: ddclient, tags: ['ddclient'] }
    - { role: ddns, tags: ['ddns'] }
    - { role: deluge, tags: ['deluge'] }
    - { role: diun, tags: ['diun'] }
    - { role: docker_socket_proxy, tags: ['docker-socket-proxy'] }
    - { role: dozzle, tags: ['dozzle'] }
    - { role: emby, tags: ['emby'] }
    - { role: gluetun, tags: ['gluetun'] }
    - { role: grafana, tags: ['grafana'] }
    - { role: jackett, tags: ['jackett'] }
    - { role: jellyfin, tags: ['jellyfin'] }
    - { role: mainline, tags: ['mainline'] }
    - { role: mariadb, tags: ['mariadb'] }
    - { role: mongodb, tags: ['mongodb'] }
    - { role: netdata, tags: ['netdata'] }
    - { role: nginx, tags: ['nginx'] }
    - { role: node_exporter, tags: ['node-exporter'] }
    - { role: nzbget, tags: ['nzbget'] }
    - { role: nzbhydra2, tags: ['nzbhydra2'] }
    - { role: nzbthrottle, tags: ['nzbthrottle'] }
    - { role: petio, tags: ['petio'] }
    - { role: plex, tags: ['plex', 'plex-reset-codecs', 'plex-reclaim'] }
    - { role: plex_db, tags: ['plex-db'] }
    - { role: postgres, tags: ['postgres'] }
    - { role: prometheus, tags: ['prometheus'] }
    - { role: prowlarr, tags: ['prowlarr'] }
    - { role: python, tags: ['python'] }
    - { role: qbittorrent, tags: ['qbittorrent'] }
    - { role: redis, tags: ['redis'] }
    - { role: rutorrent, tags: ['rutorrent'] }
    - { role: sabnzbd, tags: ['sabnzbd'] }
    - { role: scrutiny, tags: ['scrutiny'] }
    - { role: subliminal, tags: ['subliminal'] }
    - { role: transfer, tags: ['transfer'] }
    - { role: unpackerr, tags: ['unpackerr'] }
    - { role: whisparr, tags: ['whisparr'] }
    - { role: yyq, tags: ['yyq'] }
    # Apps End
    - { role: custom, tags: ['custom'] }
    - { role: diag, tags: ['diag'] }
    - { role: hetzner_nfs, tags: ['hetzner-nfs-server', 'hetzner-nfs-server-uninstall', 'hetzner-nfs-client-mount', 'hetzner-nfs-client-unmount'] }
    - { role: hetzner_vlan, tags: ['hetzner-vlan-deploy', 'hetzner-vlan-remove'] }
    - { role: permissions, tags: ['fix-permissions'] }
    - { role: plex_auth_token, tags: ['plex-auth-token'] }
    - { role: plex_fix_futures, tags: ['plex-fix-futures'] }
    - { role: saltbox_mod, tags: ['saltbox-mod'] }
    - { role: sub_zero, tags: ['plex-plugins-sub-zero', 'plex-plugins-sub-zero-reinstall'] }
    - { role: traefik_file_template, tags: ['generate-traefik-file-template'] }
    - { role: traefik_template, tags: ['generate-traefik-template'] }
    - { role: webtools, tags: ['plex-plugins-webtools', 'plex-plugins-webtools-reinstall'] }
    # Reboot checker
    - { role: reboot, tags: ['core', 'saltbox', 'mediabox', 'feederbox', 'system'] }
