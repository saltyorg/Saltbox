#########################################################################
# Title:         Saltbox: MOTD Role                                     #
# Author(s):     salty                                                  #
# URL:           https://github.com/saltyorg/Saltbox                    #
# --                                                                    #
#########################################################################
#                   GNU General Public License v3.0                     #
#########################################################################
---
- name: Generate Config tasks
  when: ('motd-generate-config' in ansible_run_tags)
  block:
    - name: Get Instance Info
      ansible.builtin.include_tasks: "{{ resources_tasks_path }}/instances/get_info.yml"
      vars:
        get_info_list:
          - plex
          - sonarr
          - radarr
          - lidarr

    - name: Import 'motd.yml' template
      ansible.builtin.template:
        src: "motd.yml.j2"
        dest: "/srv/git/saltbox/motd.yml"
        owner: "{{ user.name }}"
        group: "{{ user.name }}"
        mode: "0664"
        force: true

- name: Import '01-motd' template
  ansible.builtin.template:
    src: "01-motd.j2"
    dest: "/etc/update-motd.d/01-motd"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: "0755"
    force: true
