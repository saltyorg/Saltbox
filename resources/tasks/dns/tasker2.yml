#########################################################################
# Title:         Saltbox: Resources | Tasks | DNS | Tasker              #
# Author(s):     desimaniac, salty                                      #
# URL:           https://github.com/saltyorg/Saltbox                    #
# --                                                                    #
#########################################################################
#                   GNU General Public License v3.0                     #
#########################################################################
---
- name: Resources | Tasks | DNS | Tasker | Parse domain
  tld_parse:
    url: "{{ dns_zone | default(user.domain) }}"
    record: "{{ dns_record | default('') }}"
  register: domain_parsed

- name: Resources | Tasks | DNS | Tasker | Set '_dns_*' variables
  ansible.builtin.set_fact:
    _dns_tasker_zone: "{{ domain_parsed.fld }}"
    _dns_tasker_record: "{{ domain_parsed.record }}"
    _dns_tasker_action: "{{ dns_action | default('add') }}"
    _dns_tasker_proxy: "{{ dns_proxy | default(dns_proxied) }}"

- name: Resources | Tasks | DNS | Tasker | Sent task to DNS Role
  ansible.builtin.include_role:
    name: dns
  vars:
    _dns_role_record: "{{ _dns_tasker_record }}"
    _dns_role_zone: "{{ _dns_tasker_zone }}"
    _dns_role_action: "{{ _dns_tasker_action }}"
    _dns_role_proxy: "{{ _dns_tasker_proxy }}"
