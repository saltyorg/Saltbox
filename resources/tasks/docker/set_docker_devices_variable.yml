######################################################################################
# Title:         Saltbox: Resources | Tasks | Docker | Set Docker Devices Variable   #
# Author(s):     desimaniac, salty                                                   #
# URL:           https://github.com/saltyorg/Saltbox                                 #
# --                                                                                 #
######################################################################################
#                   GNU General Public License v3.0                                  #
######################################################################################
---
- name: Resources | Tasks | Docker | Set Docker Devices Variable | Set '_var_prefix' variable
  ansible.builtin.set_fact:
    _var_prefix: "{{ var_prefix
                  if (var_prefix is defined)
                  else role_name }}"

- name: Resources | Tasks | Docker | Set Docker Devices Variable | Set instance name
  ansible.builtin.set_fact:
    _instance_name: "{{ lookup('vars', _var_prefix + '_name', default=_var_prefix) }}"

- name: Resources | Tasks | Docker | Set Docker Devices Variable | Check if '/dev/dri' exists
  ansible.builtin.stat:
    path: "/dev/dri"
  register: dev_dri

- name: Resources | Tasks | Docker | Set Docker Devices Variable | Set '_dev_dri_var_name' temp variable
  ansible.builtin.set_fact:
    _dev_dri_var_name: "{{ _instance_name + '_docker_dev_dri' }}"

- name: Resources | Tasks | Docker | Set Docker Devices Variable | Set '_dev_dri_var_name' variable # noqa var-naming[no-jinja]
  ansible.builtin.set_fact:
    "{{ _dev_dri_var_name }}": "{{ dev_dri.stat.exists }}"
